import{_ as s,c as a,o as t,ag as n}from"./chunks/framework.ko2zIC2c.js";const g=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"development/common/distributed-system/tmp.md","filePath":"development/common/distributed-system/tmp.md","lastUpdated":1768638085000}'),e={name:"development/common/distributed-system/tmp.md"};function l(r,i,h,p,o,k){return t(),a("div",null,i[0]||(i[0]=[n(`<p>åˆ†å¸ƒå¼å¯è§‚æµ‹æ€§ä¸­çš„<strong>é“¾è·¯è·Ÿè¸ª</strong>ï¼ˆDistributed Tracingï¼‰æ˜¯ç”¨äºç†è§£å’Œåˆ†æåœ¨å¾®æœåŠ¡æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¯·æ±‚å¦‚ä½•åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´æµè½¬çš„å…³é”®æŠ€æœ¯ã€‚å®ƒå¸®åŠ©å¼€å‘è€…å’Œè¿ç»´äººå‘˜è¯Šæ–­æ€§èƒ½ç“¶é¢ˆã€æ’æŸ¥é”™è¯¯æ ¹æºï¼Œå¹¶ä¼˜åŒ–æ•´ä½“ç³»ç»Ÿæ¶æ„ã€‚</p><hr><h2 id="yishi-me-shi-lian-lu-gen-zong" tabindex="-1">ä¸€ã€ä»€ä¹ˆæ˜¯é“¾è·¯è·Ÿè¸ªï¼Ÿ <a class="header-anchor" href="#yishi-me-shi-lian-lu-gen-zong" aria-label="Permalink to &quot;ä¸€ã€ä»€ä¹ˆæ˜¯é“¾è·¯è·Ÿè¸ªï¼Ÿ&quot;">â€‹</a></h2><p>é“¾è·¯è·Ÿè¸ªé€šè¿‡ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„ <strong>Trace ID</strong>ï¼Œå¹¶åœ¨è¯¥è¯·æ±‚ç©¿è¶Šå„ä¸ªæœåŠ¡æ—¶ä¼ æ’­æ­¤ IDï¼Œä»è€Œå°†æ•´ä¸ªè°ƒç”¨é“¾ä¸Šçš„æ‰€æœ‰æ“ä½œä¸²è”èµ·æ¥ã€‚æ¯ä¸ªæœåŠ¡åœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šè®°å½•ä¸€ä¸ªæˆ–å¤šä¸ª <strong>Span</strong>ï¼ˆè¡¨ç¤ºä¸€æ¬¡æ“ä½œæˆ–å­æ“ä½œï¼‰ï¼Œè¿™äº› Span æŒ‰ç…§çˆ¶å­å…³ç³»ç»„ç»‡æˆä¸€æ£µæ ‘ï¼Œæ„æˆå®Œæ•´çš„ <strong>Trace</strong>ã€‚</p><h3 id="he-xin-gai-nian" tabindex="-1">æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#he-xin-gai-nian" aria-label="Permalink to &quot;æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h3><ul><li><strong>Traceï¼ˆè¿½è¸ªï¼‰</strong>ï¼šä»£è¡¨ä¸€æ¬¡å®Œæ•´çš„ç«¯åˆ°ç«¯è¯·æ±‚æµç¨‹ã€‚</li><li><strong>Spanï¼ˆè·¨åº¦ï¼‰</strong>ï¼šä»£è¡¨ Trace ä¸­çš„ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œä¾‹å¦‚ä¸€æ¬¡å‡½æ•°è°ƒç”¨ã€æ•°æ®åº“æŸ¥è¯¢æˆ– HTTP è¯·æ±‚ã€‚</li><li><strong>Trace ID</strong>ï¼šå…¨å±€å”¯ä¸€æ ‡è¯†ä¸€ä¸ª Traceã€‚</li><li><strong>Span ID</strong>ï¼šæ ‡è¯†å½“å‰ Spanã€‚</li><li><strong>Parent Span ID</strong>ï¼šæ ‡è¯†çˆ¶ Spanï¼ˆæ ¹ Span çš„ Parent ID ä¸ºç©ºï¼‰ã€‚</li><li><strong>ä¸Šä¸‹æ–‡ä¼ æ’­ï¼ˆContext Propagationï¼‰</strong>ï¼šç¡®ä¿ Trace ID å’Œ Span ID åœ¨æœåŠ¡é—´æ­£ç¡®ä¼ é€’ï¼ˆé€šå¸¸é€šè¿‡ HTTP Headerã€æ¶ˆæ¯å¤´ç­‰ï¼‰ã€‚</li></ul><hr><h2 id="erlian-lu-gen-zong-de-zuo-yong" tabindex="-1">äºŒã€é“¾è·¯è·Ÿè¸ªçš„ä½œç”¨ <a class="header-anchor" href="#erlian-lu-gen-zong-de-zuo-yong" aria-label="Permalink to &quot;äºŒã€é“¾è·¯è·Ÿè¸ªçš„ä½œç”¨&quot;">â€‹</a></h2><ol><li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šè¯†åˆ«æ…¢è¯·æ±‚ã€é«˜å»¶è¿ŸæœåŠ¡ã€‚</li><li><strong>æ•…éšœå®šä½</strong>ï¼šå¿«é€Ÿå‘ç°é”™è¯¯å‘ç”Ÿçš„ä½ç½®åŠä¼ æ’­è·¯å¾„ã€‚</li><li><strong>ä¾èµ–åˆ†æ</strong>ï¼šå¯è§†åŒ–æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚</li><li><strong>å®¹é‡è§„åˆ’</strong>ï¼šäº†è§£å„æœåŠ¡è´Ÿè½½æƒ…å†µã€‚</li><li><strong>SLA/SLO ç›‘æ§</strong>ï¼šéªŒè¯æœåŠ¡æ˜¯å¦æ»¡è¶³å“åº”æ—¶é—´æ‰¿è¯ºã€‚</li></ol><hr><h2 id="sanzhu-liu-lian-lu-gen-zong-xi-tong" tabindex="-1">ä¸‰ã€ä¸»æµé“¾è·¯è·Ÿè¸ªç³»ç»Ÿ <a class="header-anchor" href="#sanzhu-liu-lian-lu-gen-zong-xi-tong" aria-label="Permalink to &quot;ä¸‰ã€ä¸»æµé“¾è·¯è·Ÿè¸ªç³»ç»Ÿ&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç³»ç»Ÿ</th><th>ç‰¹ç‚¹</th><th>åè®®/æ ‡å‡†</th></tr></thead><tbody><tr><td><strong>Jaeger</strong></td><td>CNCF é¡¹ç›®ï¼Œæ”¯æŒé‡‡æ ·ã€ä¾èµ–å›¾ã€UI å¯è§†åŒ–</td><td>OpenTracing / OpenTelemetry</td></tr><tr><td><strong>Zipkin</strong></td><td>Twitter å¼€æºï¼Œè½»é‡çº§ï¼Œæ˜“äºé›†æˆ</td><td>Zipkin API / Brave</td></tr><tr><td><strong>OpenTelemetry (OTel)</strong></td><td>CNCF æ–°ä¸€ä»£å¯è§‚æµ‹æ€§æ ‡å‡†ï¼Œç»Ÿä¸€ Metrics/Logs/Traces</td><td>OTLPï¼ˆOpenTelemetry Protocolï¼‰</td></tr><tr><td><strong>SkyWalking</strong></td><td>å›½äº§å¼€æºï¼Œæ”¯æŒè‡ªåŠ¨æ¢é’ˆã€æœåŠ¡ç½‘æ ¼ã€å‘Šè­¦</td><td>è‡ªç ” + OpenTelemetry å…¼å®¹</td></tr><tr><td><strong>Datadog APM / New Relic / AWS X-Ray</strong></td><td>å•†ä¸šæ–¹æ¡ˆï¼Œé›†æˆåº¦é«˜ï¼ŒåŠŸèƒ½å…¨é¢</td><td>å„è‡ª SDK</td></tr></tbody></table><blockquote><p>âœ… å½“å‰è¡Œä¸šè¶‹åŠ¿ï¼š<strong>OpenTelemetry æˆä¸ºäº‹å®æ ‡å‡†</strong>ï¼Œæ¨èæ–°é¡¹ç›®ä¼˜å…ˆé‡‡ç”¨ã€‚</p></blockquote><hr><h2 id="sishi-xian-lian-lu-gen-zong-de-guan-jian-bu-zou" tabindex="-1">å››ã€å®ç°é“¾è·¯è·Ÿè¸ªçš„å…³é”®æ­¥éª¤ <a class="header-anchor" href="#sishi-xian-lian-lu-gen-zong-de-guan-jian-bu-zou" aria-label="Permalink to &quot;å››ã€å®ç°é“¾è·¯è·Ÿè¸ªçš„å…³é”®æ­¥éª¤&quot;">â€‹</a></h2><ol><li><p><strong>æ³¨å…¥ Trace ä¸Šä¸‹æ–‡</strong></p><ul><li>åœ¨å…¥å£ï¼ˆå¦‚ API ç½‘å…³ï¼‰ç”Ÿæˆ Trace IDã€‚</li><li>é€šè¿‡ HTTP Headerï¼ˆå¦‚ <code>traceparent</code>ï¼‰æˆ–æ¶ˆæ¯é˜Ÿåˆ—å±æ€§ä¼ æ’­ã€‚</li></ul></li><li><p><strong>åŸ‹ç‚¹ï¼ˆInstrumentationï¼‰</strong></p><ul><li>æ‰‹åŠ¨ï¼šä½¿ç”¨ SDK åˆ›å»º Spanã€‚</li><li>è‡ªåŠ¨ï¼šé€šè¿‡å­—èŠ‚ç å¢å¼ºï¼ˆå¦‚ Java Agentï¼‰è‡ªåŠ¨æ•è·æ¡†æ¶è°ƒç”¨ï¼ˆSpringã€gRPCã€HTTP Client ç­‰ï¼‰ã€‚</li></ul></li><li><p><strong>å¯¼å‡ºæ•°æ®</strong></p><ul><li>å°† Span æ•°æ®å‘é€åˆ°åç«¯ï¼ˆå¦‚ Jaeger Collectorã€OTel Collectorï¼‰ã€‚</li></ul></li><li><p><strong>å­˜å‚¨ä¸å¯è§†åŒ–</strong></p><ul><li>ä½¿ç”¨åç«¯å­˜å‚¨ï¼ˆå¦‚ Elasticsearchã€Cassandraï¼‰ä¿å­˜ Traceã€‚</li><li>é€šè¿‡ UI æŸ¥çœ‹è°ƒç”¨é“¾ã€è€—æ—¶åˆ†å¸ƒã€é”™è¯¯æ ‡è®°ç­‰ã€‚</li></ul></li></ol><hr><h2 id="wushi-liwei-dai-ma" tabindex="-1">äº”ã€ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰ <a class="header-anchor" href="#wushi-liwei-dai-ma" aria-label="Permalink to &quot;äº”ã€ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰&quot;">â€‹</a></h2><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ OpenTelemetry Python SDK</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opentelemetry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> trace</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opentelemetry.exporter.jaeger.thrift </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JaegerExporter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opentelemetry.sdk.trace </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerProvider</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opentelemetry.sdk.trace.export </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BatchSpanProcessor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é…ç½® Jaeger å¯¼å‡ºå™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jaeger_exporter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JaegerExporter(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">agent_host_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">agent_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6831</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trace.set_tracer_provider(TracerProvider())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trace.get_tracer_provider().add_span_processor(BatchSpanProcessor(jaeger_exporter))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tracer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> trace.get_tracer(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__name__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tracer.start_as_current_span(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;order-service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è°ƒç”¨ payment-service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ³¨å…¥ trace context</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    inject(headers)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OpenTelemetry context propagation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    requests.post(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://payment-service/pay&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">headers)</span></span></code></pre></div><hr><h2 id="liutiao-zhan-yu-zui-jia-shi-jian" tabindex="-1">å…­ã€æŒ‘æˆ˜ä¸æœ€ä½³å®è·µ <a class="header-anchor" href="#liutiao-zhan-yu-zui-jia-shi-jian" aria-label="Permalink to &quot;å…­ã€æŒ‘æˆ˜ä¸æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="tiao-zhan" tabindex="-1">æŒ‘æˆ˜ <a class="header-anchor" href="#tiao-zhan" aria-label="Permalink to &quot;æŒ‘æˆ˜&quot;">â€‹</a></h3><ul><li>ä¸Šä¸‹æ–‡ä¼ æ’­åœ¨å¼‚æ­¥/æ¶ˆæ¯é˜Ÿåˆ—åœºæ™¯å¤æ‚ã€‚</li><li>é«˜é¢‘è¯·æ±‚å¯¼è‡´æ•°æ®é‡çˆ†ç‚¸ï¼ˆéœ€åˆç†é‡‡æ ·ï¼‰ã€‚</li><li>å¤šè¯­è¨€/å¤šåè®®ç¯å¢ƒé›†æˆå›°éš¾ã€‚</li></ul><h3 id="zui-jia-shi-jian" tabindex="-1">æœ€ä½³å®è·µ <a class="header-anchor" href="#zui-jia-shi-jian" aria-label="Permalink to &quot;æœ€ä½³å®è·µ&quot;">â€‹</a></h3><ul><li>é‡‡ç”¨ <strong>OpenTelemetry</strong> ç»Ÿä¸€åŸ‹ç‚¹æ ‡å‡†ã€‚</li><li>ä½¿ç”¨ <strong>OTel Collector</strong> ä½œä¸ºä¸­é—´ä»£ç†ï¼Œè§£è€¦åº”ç”¨ä¸åç«¯ã€‚</li><li>åˆç†é…ç½® <strong>é‡‡æ ·ç­–ç•¥</strong>ï¼ˆå¦‚å¤´éƒ¨é‡‡æ ·ã€å°¾éƒ¨é‡‡æ ·ã€åŠ¨æ€é‡‡æ ·ï¼‰ã€‚</li><li>ä¸æ—¥å¿—ã€æŒ‡æ ‡æ‰“é€šï¼ˆå¦‚å°† Trace ID å†™å…¥æ—¥å¿—ï¼Œä¾¿äºå…³è”åˆ†æï¼‰ã€‚</li></ul><hr><h2 id="qizong-jie" tabindex="-1">ä¸ƒã€æ€»ç»“ <a class="header-anchor" href="#qizong-jie" aria-label="Permalink to &quot;ä¸ƒã€æ€»ç»“&quot;">â€‹</a></h2><p>é“¾è·¯è·Ÿè¸ªæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¯è§‚æµ‹æ€§çš„ä¸‰å¤§æ”¯æŸ±ä¹‹ä¸€ï¼ˆå¦ä¸¤è€…æ˜¯ Metrics å’Œ Logsï¼‰ã€‚é€šè¿‡æ„å»ºå®Œæ•´çš„è°ƒç”¨é“¾è§†å›¾ï¼Œå®ƒè®©â€œé»‘ç›’â€ç³»ç»Ÿå˜å¾—é€æ˜ï¼Œæ˜¯ä¿éšœç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§çš„æ ¸å¿ƒèƒ½åŠ›ã€‚</p><blockquote><p>ğŸ“Œ å»ºè®®ï¼šæ–°é¡¹ç›®ç›´æ¥åŸºäº <strong>OpenTelemetry + OTel Collector + Jaeger/Prometheus/Loki</strong> æ„å»ºç»Ÿä¸€å¯è§‚æµ‹æ€§å¹³å°ã€‚</p></blockquote><p>å¦‚éœ€å…·ä½“è¯­è¨€ï¼ˆJava/Go/Pythonï¼‰çš„é›†æˆç¤ºä¾‹æˆ–æ¶æ„è®¾è®¡å»ºè®®ï¼Œå¯ç»§ç»­æé—®ï¼</p>`,30)]))}const c=s(e,[["render",l]]);export{g as __pageData,c as default};
