import{_ as i,c as a,o as n,ag as p}from"./chunks/framework.ko2zIC2c.js";const t="/assets/frp-ssh-connection.CdoPYao0.svg",o=JSON.parse('{"title":"frp","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"gadgets/frp/index.md","filePath":"gadgets/frp/index.md","lastUpdated":1750902143000}'),l={name:"gadgets/frp/index.md"};function h(e,s,k,r,d,c){return n(),a("div",null,s[0]||(s[0]=[p(`<h1 id="frp" tabindex="-1">frp <a class="header-anchor" href="#frp" aria-label="Permalink to &quot;frp&quot;">​</a></h1><p>官方文档 <a href="https://gofrp.org" target="_blank" rel="noreferrer">https://gofrp.org</a></p><h2 id="wei-shi-me-shi-yong-frp" tabindex="-1">为什么使用 frp ？ <a class="header-anchor" href="#wei-shi-me-shi-yong-frp" aria-label="Permalink to &quot;为什么使用 frp ？&quot;">​</a></h2><p>通过在具有公网 IP 的节点上部署 frp 服务端，可以轻松地将内网服务穿透到公网，同时提供诸多专业的功能特性，这包括：</p><ul><li>客户端服务端通信支持 TCP、QUIC、KCP 以及 Websocket 等多种协议。</li><li>采用 TCP 连接流式复用，在单个连接间承载更多请求，节省连接建立时间，降低请求延迟。</li><li>代理组间的负载均衡。</li><li>端口复用，多个服务通过同一个服务端端口暴露。</li><li>支持 P2P 通信，流量不经过服务器中转，充分利用带宽资源。</li><li>多个原生支持的客户端插件（静态文件查看，HTTPS/HTTP 协议转换，HTTP、SOCK5 代理等），便于独立使用 frp 客户端完成某些工作。</li><li>高度扩展性的服务端插件系统，易于结合自身需求进行功能扩展。</li><li>服务端和客户端 UI 页面。</li></ul><h2 id="xia-zai-frp" tabindex="-1">下载 frp <a class="header-anchor" href="#xia-zai-frp" aria-label="Permalink to &quot;下载 frp&quot;">​</a></h2><p>下载 <a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noreferrer">frp</a> 并解压后，在目录下有如下文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">frp_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;version&gt;_&lt;platform&gt;_&lt;arch&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # frp client 客户端</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc.toml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # frp client 配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # frp server 服务端</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps.toml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # frp server 配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LICENSE</span></span></code></pre></div><h2 id="tong-guo-ssh-fang-wen-nei-wang-ji-qi" tabindex="-1">通过 SSH 访问内网机器 <a class="header-anchor" href="#tong-guo-ssh-fang-wen-nei-wang-ji-qi" aria-label="Permalink to &quot;通过 SSH 访问内网机器&quot;">​</a></h2><h3 id="fu-wu-duan-pei-zhi" tabindex="-1">服务端配置 <a class="header-anchor" href="#fu-wu-duan-pei-zhi" aria-label="Permalink to &quot;服务端配置&quot;">​</a></h3><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>假设服务端是一台具有公网IP的机器，将在公网机器上部署 frp 服务端 (frps)。</p></div><p>部署 frps 并编辑 <code>frps.toml</code> 文件。以下是简化的配置，其中设置了 frp 服务器用于接收客户端连接的端口：</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bindPort = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7000</span></span></code></pre></div><p>需要开放对应的端口</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置需要开放的端口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">7000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/tcp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 添加 frps 端口  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 更新防火墙规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --list-ports</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查看已开放的端口</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果后续不再使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --remove-port=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">/tcp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 移除端口</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><ul><li>如果是云服务器上部署的话，请把云服务器的防火墙中的端口也一同打开，只打开系统的防火墙端口也是无法访问</li><li>建议找不限制流量、限制带宽的云服务器服务</li><li><code>firewalld</code> 可能需要安装</li></ul></div><p>启动 frps 服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">frps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps.toml</span></span></code></pre></div><h3 id="ke-hu-duan-pei-zhi" tabindex="-1">客户端配置 <a class="header-anchor" href="#ke-hu-duan-pei-zhi" aria-label="Permalink to &quot;客户端配置&quot;">​</a></h3><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>假设客户端是一台没有公网IP的内网机器，将在内网机器上部署 frp 客户端 (frpc)</p></div><p>修改 <code>frpc.toml</code> 配置文件，配置 frpc 服务端</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serverAddr = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x.x.x.x&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serverPort = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">proxies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ssh&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tcp&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localIP = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localPort = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remotePort = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6000</span></span></code></pre></div><p>启动 frpc 服务，查看是否连接成功</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">frpc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc.toml</span></span></code></pre></div><p>连接成功后会输出日志，出现 <code>start proxy success</code> 的信息表示代理启动成功。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YYYY-MM-DD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HH:MM:SS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [I] start frpc service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config file [./frpc.toml]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YYYY-MM-DD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HH:MM:SS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [I] try to connect to server...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YYYY-MM-DD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HH:MM:SS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [I] [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] login to server success, get run id [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YYYY-MM-DD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HH:MM:SS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [I] [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] proxy added: [web]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">YYYY-MM-DD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HH:MM:SS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [I][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [web] start proxy success</span></span></code></pre></div><p>就可以使用 ssh 命令访问内网机器</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@x.x.x.x</span></span></code></pre></div><h3 id="ssh-dai-li-yuan-li" tabindex="-1">SSH 代理原理 <a class="header-anchor" href="#ssh-dai-li-yuan-li" aria-label="Permalink to &quot;SSH 代理原理&quot;">​</a></h3><p><img src="`+t+`" alt="FRP SSH Connection"></p><ul><li>服务端 frps 启动时，会持续监听 <code>7000</code> 端口</li><li>当客户端 frpc 启动时，会通过监听端口 <code>7000</code> 进行注册（告诉服务端内网机器的被代理端口 <code>22</code> 和服务器上监听转发端口 <code>6000</code>），并建立一个长连接，如果连接失败，则会尝试重新建立连接</li><li>当用户外部访问服务端指定端口 <code>6000</code> 的时候，服务端会将流量转发至内网机器的被代理端口 <code>22</code> 上</li></ul><h2 id="shi-yong-systemd-lai-guan-li-frp-fu-wu" tabindex="-1">使用 systemd 来管理 frp 服务 <a class="header-anchor" href="#shi-yong-systemd-lai-guan-li-frp-fu-wu" aria-label="Permalink to &quot;使用 systemd 来管理 frp 服务&quot;">​</a></h2><p>在 Linux 系统下，使用 systemd 可以方便地控制服务的启动、停止、配置后台运行以及开机自启动。</p><h3 id="pei-zhi-frps-fu-wu" tabindex="-1">配置 frps 服务 <a class="header-anchor" href="#pei-zhi-frps-fu-wu" aria-label="Permalink to &quot;配置 frps 服务&quot;">​</a></h3><p>将 frps 移动到 <code>/usr/local/bin</code> 目录下，配置文件移动到 <code>/etc/frp</code> 目录下</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/frp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps.toml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/frp/</span></span></code></pre></div><p>在 <code>/etc/systemd/system</code> 下创建 <code>frps.service</code> 用于配置 frps 服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/frps.service</span></span></code></pre></div><p>写入内容</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = frp server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">After</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = network.target syslog.target</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Wants</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = simple</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /usr/local/bin/frps -c /etc/frp/frps.toml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在失败时自动重启</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = on-failure</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启间隔时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestartSec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 5s</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务启动超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TimeoutStartSec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 30s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WantedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = multi-user.target</span></span></code></pre></div><p>使用 systemd 命令管理 frps 服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   frps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 启动服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    frps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 停止服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 重启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  frps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查看日志</span></span></code></pre></div><p>设置 frps 开机自启动</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frps</span></span></code></pre></div><h3 id="pei-zhi-frpc-fu-wu" tabindex="-1">配置 frpc 服务 <a class="header-anchor" href="#pei-zhi-frpc-fu-wu" aria-label="Permalink to &quot;配置 frpc 服务&quot;">​</a></h3><p>将 frpc 移动到 <code>/usr/local/bin</code> 目录下，配置文件移动到 <code>/etc/frp</code> 目录下</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/frp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc.toml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/frp/</span></span></code></pre></div><p>启动 frpc 服务，查看是否启动成功（日志输出 <code>start proxy success</code>）</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/local/bin/frpc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/frp/frpc.toml</span></span></code></pre></div><p>确定连接成功后，可以将 frpc 配置为系统服务。在 <code>/etc/systemd/system</code> 下创建 <code>frpc.service</code> 用于配置 frpc 服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/systemd/system/frpc.service</span></span></code></pre></div><p>写入内容</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = frp client</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">After</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=network.target network-online.target</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Wants</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=network-online.target</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保只有在网络可用的情况下，服务才会运行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Requires</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=network-online.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = simple</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 frpc 的命令, 修改为您的 frpc的安装路径</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /usr/local/bin/frpc -c /etc/frp/frpc.toml</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExecStop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=/bin/kill $MAINPID</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保无论服务是正常退出还是异常崩溃，都会尝试重启</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启间隔</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestartSec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁用启动限制，允许服务无限次重启</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">StartLimitInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WantedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = multi-user.target</span></span></code></pre></div><p>使用 systemd 命令管理 frpc 服务</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   frpc</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 启动服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    frpc</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 停止服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 重启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  frpc</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查看日志</span></span></code></pre></div><p>设置 frpc 开机自启动</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frpc</span></span></code></pre></div>`,57)]))}const F=i(l,[["render",h]]);export{o as __pageData,F as default};
